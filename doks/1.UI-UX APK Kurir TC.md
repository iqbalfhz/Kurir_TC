# UI/UX & Dokumentasi Singkat — APK Kurir TC

> Catatan: Nama file memakai tanda hubung **UI-UX** (bukan `UI/UX`) karena karakter `/` tidak valid untuk nama file di banyak sistem. Anda dapat mengganti nama file setelah diunduh jika diperlukan.

---

Dokumentasi ini menggabungkan ringkasan UI/UX dan catatan teknis untuk aplikasi "Kurir TC". Isi mencakup arsitektur navigasi, deskripsi halaman, komponen reusable, layanan backend yang dipanggil aplikasi, model data utama, dan rekomendasi pengembangan lanjutan.

## Ringkasan Aplikasi & Arsitektur

- Fokus utama: kurir dapat login, melihat beranda pengiriman, menambahkan pengiriman (foto + alamat), melihat riwayat, dan mengelola profil.
- UI: Material 3, mendukung Light/Dark theme.
- Navigasi inti (didefinisikan di `app.dart`): `/login`, `/home`, `/delivery`, `/profile`, `/history`.
- Bottom navigation untuk halaman utama diimplementasikan melalui `AppShell` (reusable widget).

---

## Struktur Proyek (ringkas)

```
lib/
├─ app.dart                     # MaterialApp & routes
├─ services/
│  ├─ api_service.dart          # HTTP client (Dio) + auth
│  ├─ storage_service.dart      # Secure token storage
│  └─ theme_controller.dart     # ThemeMode ValueNotifier
├─ models/
│  └─ user.dart                 # User model
├─ pages/
│  ├─ login_page.dart
│  ├─ home_page.dart
│  ├─ delivery_page.dart
│  ├─ history_page.dart
│  └─ profile_page.dart
└─ widgets/
   ├─ app_shell.dart            # Shell with bottom NavigationBar
   ├─ app_button.dart           # Reusable button with loading
   └─ app_text_field.dart       # Reusable text field
```

---

## Navigasi & Rute

Rute utama didefinisikan di `app.dart`. `LoginPage` adalah entry default. Setelah autentikasi sukses, aplikasi menavigasi ke `/home`. Pada halaman utama (Home, History, Profile) `AppShell` menyediakan bottom navigation untuk pindah antar-tab menggunakan `Navigator.pushReplacementNamed` sehingga stack tidak menumpuk.

---

## Halaman & UX Detail

### Login (`LoginPage`)

- Kartu tengah yang fokus dengan efek blur dan animasi latar (blob)
- Field: Email & Password (toggle visibility)
- Tombol Masuk (loading state) dan link Lupa Password
- Theme toggle (pojok kanan atas)
- Validasi sederhana (email tidak kosong, password >= 6)
- Panggilan: `ApiService.login(email, password)` → menyimpan token via `StorageService` → memanggil `/me` → navigasi ke `/home`.

### Lupa Password (`ForgotPasswordPage`)

- Alur OTP: kirim OTP → masukkan OTP + password baru → reset
- Validasi: format email, OTP minimal 4 digit, password minimal 6
- Panggilan: `ApiService.sendOtp(email)` dan `ApiService.resetPassword(...)`

### Home (`HomePage`)

- `SliverAppBar` modern menampilkan greeting, tanggal, dan avatar inisial
- Ringkasan statistik dan daftar pengiriman hari ini
- FAB "Tambah Pengiriman" membuka `/delivery` dan akan memicu refresh jika berhasil
- Data user diambil via `ApiService.me()`

### Tambah Pengiriman (`DeliveryPage`)

- Form: foto dokumen, nama pengirim, nama penerima, alamat tujuan, catatan
- Foto: pilih kamera/galeri; buat dua versi image (preview & upload) menggunakan `flutter_image_compress`
- Kompresi adaptif: preview (1600px, q80), upload (target ~350KB, prefer WebP on Android)
- Tombol sticky di bottom: Mulai Antar
- TODO: integrasi geolocator untuk koordinat, endpoint backend untuk submit

### Riwayat (`HistoryPage`)

- Pencarian teks, filter status (ChoiceChip), filter rentang tanggal
- Grup hasil per tanggal (Hari ini, Kemarin, atau dd MMM yyyy)
- RefreshIndicator & empty state

### Profil (`ProfilePage`)

- Header profil (avatar/foto atau inisial), statistik cepat
- Section Akun (ubah nama, lihat email, ganti password)
- Preferensi: toggle mode gelap (via `ThemeController`), notifikasi (MVP)
- Tentang: versi aplikasi & kebijakan privasi

---

## Komponen Reusable

- `AppShell` — scaffold wrapper dengan bottom navigation. Pastikan `currentIndex` benar dan `body` berisi konten halaman.
- `AppButton` — tombol yang mendukung state loading.
- `AppTextField` — TextFormField kecil dengan label & validator.

---

## Layanan (Services) & Alur API

- `ApiService` (`services/api_service.dart`):

  - Base URL: `http://10.0.2.2:8000/api/auth` untuk Android emulator, `http://127.0.0.1:8000/api/auth` untuk non-Android.
  - Menggunakan Dio dengan interceptor untuk menambahkan Authorization header jika token tersedia.
  - Metode penting:
    - `login(email, password)` — POST /login, simpan token, GET /me
    - `me()` — GET /me
    - `logout()` — POST /logout (selalu clear token lokal)
    - `sendOtp(email)` — POST /send-otp
    - `resetPassword(...)` — POST /reset-password

- `StorageService` — wrapper `flutter_secure_storage` untuk menyimpan token (`auth_token`).

Alur autentikasi:

1. Login → `ApiService.login` menyimpan token via `StorageService`.
2. Semua request berikutnya disertai header Authorization oleh interceptor.
3. Logout memanggil endpoint lalu menghapus token lokal.

---

## Model

- `User` (models/user.dart): `id`, `name`, `email`, `avatarUrl`. Factory `fromJson` ada untuk parsing respons API.

---

## Validasi & Utilities

- `Validators` (`utils/validators.dart`) menyediakan: `email`, `password`, `notEmpty`.

---

## Catatan Implementasi & TODO

- DeliveryPage: tambahkan integrasi `geolocator` untuk ambil koordinat; pertimbangkan reverse-geocoding.
- ProfilePage: implementasikan endpoint update profile & change password (UI sudah ada sebagai MVP).
- Persistensi pengiriman: saat ini data pengiriman di Home/History bersifat statis — tambahkan backend API atau local DB (Hive/SQLite) untuk sinkronisasi dan offline.
- Error handling di `ApiService`: saat ini minimal — pertimbangkan retry, timeout handling lebih baik.
- i18n: teks inline menggunakan Bahasa Indonesia. Siapkan `intl` jika perlu dukungan multi-bahasa.

---

## Rekomendasi Pengembangan Lanjutan

- State management (Riverpod/Bloc) untuk memisahkan UI dan logika.
- Local DB (Hive/Isar/SQLite) untuk caching/sync offline.
- Permission handling (`permission_handler`) untuk kamera/galeri/lokasi.
- Geolocation & Maps (geolocator + google_maps_flutter) untuk tracking dan navigasi.
- Notifikasi push (FCM) untuk update status.

---

## Cuplikan Kode & Referensi Singkat

**Navigasi tab di AppShell**:

```dart
void _onTab(BuildContext context, int i) {
  if (i == currentIndex) return;
  switch (i) {
    case 0: Navigator.pushReplacementNamed(context, '/home'); break;
    case 1: Navigator.pushReplacementNamed(context, '/history'); break;
    case 2: Navigator.pushReplacementNamed(context, '/profile'); break;
  }
}
```

**HomePage — refresh setelah tambah pengiriman**:

```dart
final result = await Navigator.pushNamed(context, '/delivery');
if (result == true) await _refresh();
```

**DeliveryPage — kompres adaptif (ringkasan)**:

```dart
final preview = await _compress(bytes: original, longSide: 1600, quality: 80);
final upload  = await _compressForUpload(original, targetKB: 350, preferWebp: true);
```
